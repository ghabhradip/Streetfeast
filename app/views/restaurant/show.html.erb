
<div style="padding-top: : 10px;padding-left: 333px;" >
  <div class="card bg-light mb-3" style="max-width: 40rem;">
    <div class="card-header"><h3><center><strong><%= @restaurant.name.capitalize %></strong></center></h3></div>
      <div class="card-body">
        <%= form_for (@restaurant),:url =>"/restaurant/update/#{@restaurant.id}" ,:html => { :multipart => true } do |f| %>
          <h3>Restaurant #<%= @restaurant.id %></h3>
          <div class="field">
            <%= f.text_field :name,:class=>"form-control",:placeholder => "Name" %>
          </div>
          <br>
          <div class="field">
            <%= f.text_area :description,:placeholder => "Description",:class=>"form-control" %>
          </div>
          <br>

          <div class="row">
            <div class="col-sm-6">
              <div class="field">
                Blacklist : <%= f.check_box :is_blacklisted %>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="field">
                Deactivate: &nbsp;<%= f.check_box :is_deactive %>
              </div>
            </div>
          </div>
          <br>
          <div class="row">
            <div class="col-sm-6">
              <div class="field">
                <%= f.text_field :operator,:class=>"form-control" ,:placeholder => "Operator"%>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="field">
                <%= f.text_field :contact_number,:class=>"form-control" ,:placeholder => "Contact Number"%>
              </div>
            </div>
          </div>
          <br>
          <div class="field">
            <%= f.fields_for @restaurant.addresses.first do |a|  %>
              <%= a.text_area :address_line,:class=>"form-control" %>
          </div>
          <br>
          <div class="row">
            <div class="col-sm-6">
              <div class="field">
                <%= a.text_field :latitude,:class=>"form-control",:placeholder => "Latitude",:id=>"latitude"  %>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="field">
                <%= a.text_field :longitude,:class=>"form-control",:placeholder => "Longitude",:id=>"longitude"  %>
              </div>
            </div>
          </div>
          <% end %>
          <br>
          <div class="row">
            <div class="col-sm-6">
              <div class="field">
                <%= f.text_field :opening_time,:id =>"timepickeropen",:class=>"form-control" ,:placeholder => "Opening Time"%>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="field">
                <%= f.text_field :closing_time,:id =>"timepickerclose",:class=>"form-control" ,:placeholder => "Closing Time"%>
              </div>
            </div>
          </div>
          <br>

          <div class="field">
            <%= button_tag "View menu",:id => "view_menu",:class=>"btn btn-success",:data=>{:toggle=>"modal",:target=> "#myModal2"} %>
          </div>
          <br>
          <div class="field">
            <% blogs = @restaurant.associated_blogs.split(',') %>
            <% blogs.each do |i| %>
              <% b = Blog.where("id =?",i.to_i).first %>
                <% b.pictures.each do |p| %>
                <img src = "<%= p.avatar %>" style="height: 100px;width: 100px;" class = "pic_show"  data-id = "<%= p.id %>" data-toggle="modal" data-target= "#myModal" data-remote = "true">
              <% end %>
            <% end %>
            <br>
          </div>
          <br>
          <div id="geolocation" style="width: 300px; height: 300px;"></div>
          <br>
          <button type="submit" class="btn btn-primary btn_large" >Update</button>&nbsp;&nbsp;
        <% end %>
        <br>
      </div>
    </div>
  </div>
</div>



<!-- modal for picture show/like -->
<div id="myModal" class="modal" role="document" >
  <div class="modal-dialog">
    <div class="modal-content" style="width: 500px;height: 500px;">
      <div class="modal-body">
        <img src="" id = "modal-pic" style="width: 466px;height: auto;">
        <hr>
          <img src="/assets/pic_like.png" style="width: 20px;height: auto;cursor: pointer;" class="pic_like">
      </div>
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>





<!-- Modal for menu_list -->
<div id="myModal2" class="modal" role="document" > 
  <div class="modal-dialog">
    <div class="modal-content" >
      <div class="modal-body2" style="max-height: 500px;" >
      </div>
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



<script type="text/javascript">

  var geocoder = new google.maps.Geocoder();
  var add =$("#restaurant_address_address_line").val().replace(/"/g,"");
  geocoder.geocode( { 'address': add}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) 
    {
      var latitude = results[0].geometry.location.lat();
      var longitude = results[0].geometry.location.lng();  
      var map;
      function initialize() 
      {
        var myLatlng = new google.maps.LatLng(latitude, longitude);
        var myOptions = {
            zoom: 15,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById("geolocation"), myOptions);
        var marker = new google.maps.Marker({
            draggable: true,
            position: myLatlng,
            map: map
        });
        google.maps.event.addListener(marker, 'dragend', function (event) {

          document.getElementById("latitude").value = event.latLng.lat();
          document.getElementById("longitude").value = event.latLng.lng();
          
        });
      }
      google.maps.event.addDomListener(window, "load", initialize());
    }
  }); 
  


  $("#view_menu").on("click",function(e){  //  show modal for menu_list
    e.preventDefault();
    var id = <%= @restaurant.id %>
    $.ajax({ 
      async: true,
      type: 'GET',
      url: "/restaurant/menu/"+id,
      success: function(data)
      {
        $(".modal-body2").html(data);  
      }, 
      error: function(data){ alert('error'); } 
    })
  })




  $(".pic_show").on("click",function(){  // show picture in modal

    var id = $(this).data('id');
    //alert(id); 
    $.ajax({ 
      async: true,
      type: 'GET',
      url: "/restaurant/pic/show/"+id,
      success: function(data)
      {
        //alert(data.id);
        $("#modal-pic").attr("src",data.pic);
        $("#modal-pic").attr("data-id",data.id);  
        //$("#pic_like").attr("data-id",data.id);
        $(".pic_like").attr("id",data.id);

        var is_liked = data.is_liked;
        if(is_liked==true)
          $("#"+data.id).attr("src","/assets/pic_unlike.png");
        else
          $("#"+data.id).attr("src","/assets/pic_like.png");

      }, 
      error: function(data){ alert('error'); } 
    })
  });


  $(".pic_like").on("click",function() // picture like functionality
  {
    var pic_id = $(".pic_like").attr("id");
      $.ajax({ 
      async: true,
      type: 'GET',
      url: "/like/pic_like/"+pic_id,
      success: function(data)
      {
        // alert(data.is_liked);
         if(data.is_liked == true)
        {
          //alert(data.is_liked);
          $("#"+data.pic_id).attr("src","/assets/pic_unlike.png");
        }
         else
        {
          //alert(data.is_liked);
          $("#"+data.pic_id).attr("src","/assets/pic_like.png");
        }
      }, 
      error: function(data){ alert('error'); } 
    })

  });

  $(function(){
    $('#toggle-event-black_list').change(function() {
    })
  })


</script>
<style type="text/css">
.modal-backdrop 
  {
    position: absolute;
    right: 0;
    left: 0;
    opacity: 0.5;
    height:100%; 
    position: fixed;
  }

  .like_style
  {
    width: 20px;
    height: auto;
    cursor: pointer;
  }


</style>